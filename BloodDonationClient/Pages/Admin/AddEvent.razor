@page "/admin/events/add"
@using BloodDonationClient.Models
@using BloodDonationClient.Services
@using Microsoft.AspNetCore.Components.Forms
@inject EventService EventService
@inject NavigationManager Navigation

<PageTitle>Admin - Add Event</PageTitle>

<div class="container my-5">
    <h3 class="text-primary">Create New Blood Donation Event</h3>

    <EditForm Model="eventCreateDto" OnValidSubmit="HandleValidSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <!-- Event Title -->
        <div class="form-group">
            <label for="title">Event Title:</label>
            <InputText id="title" @bind-Value="eventCreateDto.Title" class="form-control" placeholder="Enter event title" />
        </div>

        <!-- Event Description -->
        <div class="form-group">
            <label for="description">Event Description:</label>
            <InputTextArea id="description" @bind-Value="eventCreateDto.Description" class="form-control" placeholder="Enter event description" rows="3" />
        </div>

        <!-- Event Date -->
        <div class="form-group">
            <label for="eventDate">Event Date:</label>
            <InputDate id="eventDate" @bind-Value="eventCreateDto.EventDate" class="form-control" />
        </div>

        <!-- Event Location -->
        <div class="form-group">
            <label for="location">Event Location:</label>
            <InputText id="location" @bind-Value="eventCreateDto.Location" class="form-control" placeholder="Enter event location" />
        </div>

        <!-- Action Buttons -->
        <div class="form-group mt-4">
            <button type="submit" class="btn btn-success">Create Event</button>
            <button type="button" class="btn btn-secondary ml-2" @onclick="Cancel">Cancel</button>
        </div>
    </EditForm>

    <!-- Success and Error Messages -->
    @if (!string.IsNullOrEmpty(successMessage))
    {
        <div class="alert alert-success mt-3">@successMessage</div>
    }

    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="alert alert-danger mt-3">@errorMessage</div>
    }
</div>

@code {
    private EventCreateDto eventCreateDto = new EventCreateDto();
    private string successMessage;
    private string errorMessage;

    private async Task HandleValidSubmit()
    {
        errorMessage = string.Empty;
        successMessage = string.Empty;

        try
        {
            var success = await EventService.CreateEventAsync(eventCreateDto);
            if (success)
            {
                successMessage = "Event created successfully!";
                // Redirect to events list page after successful creation
                Navigation.NavigateTo("/admin/events");
            }
            else
            {
                errorMessage = "Failed to create the event.";
            }
        }
        catch (Exception ex)
        {
            errorMessage = "An error occurred while creating the event.";
            // Optionally log the exception for further debugging
        }
    }

    private void Cancel()
    {
        Navigation.NavigateTo("/admin/events");
    }
}